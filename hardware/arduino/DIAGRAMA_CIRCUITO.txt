╔══════════════════════════════════════════════════════════════════════════════╗
║           DIAGRAMA DE CONEXIÓN - SISTEMA AGROIRRIGATE                       ║
║           Arduino Uno R4 WiFi + Sensores IoT                                 ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│                         ARDUINO UNO R4 WIFI                                 │
│                                                                             │
│   ┌───────────────────────────────────────────────────────────┐            │
│   │  [USB] Alimentación y Programación                        │            │
│   │                                                            │            │
│   │  Pines Digitales:                    Pines Analógicos:    │            │
│   │  ┌────┐                              ┌────┐               │            │
│   │  │ 13 │ (LED Integrado)              │ A5 │               │            │
│   │  │ 12 │                              │ A4 │               │            │
│   │  │ 11 │◄───── ECHO (Sensor HC-SR04) │ A3 │               │            │
│   │  │ 10 │─────► TRIG (Sensor HC-SR04) │ A2 │               │            │
│   │  │  9 │                              │ A1 │               │            │
│   │  │  8 │                              │ A0 │◄─── (Opcional)│            │
│   │  │  7 │─────► IN (Relé)              └────┘    Sensor de  │            │
│   │  │  6 │                                        Humedad     │            │
│   │  │  5 │                              Suelo Capacitivo     │            │
│   │  │  4 │                                                    │            │
│   │  │  3 │                                                    │            │
│   │  │  2 │◄───── (Opcional) DATA (DHT22)                     │            │
│   │  │  1 │ TX                                                 │            │
│   │  │  0 │ RX                                                 │            │
│   │  └────┘                                                    │            │
│   │                                                            │            │
│   │  Alimentación:                                             │            │
│   │  ┌────────┐                                                │            │
│   │  │  5V    │─────► VCC (Sensores y Relé)                   │            │
│   │  │  GND   │─────► GND (Tierra común)                      │            │
│   │  │  3.3V  │                                                │            │
│   │  │  RESET │                                                │            │
│   │  └────────┘                                                │            │
│   │                                                            │            │
│   │  WiFi: 📶 Conectado a red local                           │            │
│   └────────────────────────────────────────────────────────────┘            │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                         SENSOR ULTRASÓNICO HC-SR04
═══════════════════════════════════════════════════════════════════════════════

    ┌─────────────────────────────────────┐
    │    HC-SR04                          │
    │                                     │
    │   ┌───┐         ┌───┐              │
    │   │ T │         │ R │              │  T = Transmisor ultrasónico
    │   │ X │         │ X │              │  R = Receptor ultrasónico
    │   └───┘         └───┘              │
    │                                     │
    │   VCC  TRIG  ECHO  GND             │
    │    │    │     │     │              │
    └────┼────┼─────┼─────┼──────────────┘
         │    │     │     │
         │    │     │     │
         │    │     │     └─────────────► GND (Arduino)
         │    │     └───────────────────► Pin 11 (Arduino)
         │    └─────────────────────────► Pin 10 (Arduino)
         └──────────────────────────────► 5V (Arduino)

    Funcionamiento:
    1. Arduino envía pulso de 10μs por TRIG
    2. Sensor emite ultrasonido
    3. Ultrasonido rebota en el agua/superficie
    4. Sensor recibe eco en ECHO
    5. Arduino calcula tiempo y distancia


═══════════════════════════════════════════════════════════════════════════════
                           MÓDULO RELÉ (1 Canal)
═══════════════════════════════════════════════════════════════════════════════

    ┌─────────────────────────────────────┐
    │   MÓDULO RELÉ 5V                    │
    │                                     │
    │   [LED]  Indicador de estado       │
    │                                     │
    │   VCC  GND  IN                      │
    │    │    │   │                       │
    └────┼────┼───┼───────────────────────┘
         │    │   │
         │    │   └───────────────────────► Pin 7 (Arduino)
         │    └───────────────────────────► GND (Arduino)
         └────────────────────────────────► 5V (Arduino)

    Contactos del Relé:
    ┌─────────────────┐
    │   COM  NO  NC   │  COM = Común
    │    │   │   │    │  NO  = Normalmente Abierto
    └────┼───┼───┼────┘  NC  = Normalmente Cerrado
         │   │   │
         │   │   └──────────► (No usado)
         │   └──────────────► (+) Bomba/Válvula
         └──────────────────► Fuente de Alimentación (+12V)

    Lógica de Control:
    - Pin 7 HIGH (5V) → Relé DESACTIVADO → Bomba apagada
    - Pin 7 LOW  (0V) → Relé ACTIVADO   → Bomba encendida


═══════════════════════════════════════════════════════════════════════════════
                    CONEXIÓN DE BOMBA DE AGUA / VÁLVULA
═══════════════════════════════════════════════════════════════════════════════

    Fuente 12V DC                    Bomba de Agua 12V
    ┌──────────┐                    ┌──────────────┐
    │    (+)   │─────────┐          │              │
    │          │         │          │   Motor DC   │
    │    (-)   │─────────┼──────────│   12V        │
    └──────────┘         │          │              │
                         │          └──────────────┘
                         │                 │
                         │                 │
                      ┌──▼──┐           ┌──▼──┐
                      │ COM │           │  -  │
                      │     │           └─────┘
                      │  NO │───────────────┘
                      └─────┘
                     Relé Arduino

    Seguridad:
    ⚠️  Use diodo volante (1N4007) en paralelo con la bomba
        para proteger contra picos de voltaje


═══════════════════════════════════════════════════════════════════════════════
         SENSORES ADICIONALES (OPCIONAL - PARA EXPANSIÓN)
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│  1. SENSOR DHT22 (Temperatura y Humedad Ambiental)                         │
│                                                                             │
│      DHT22                                                                  │
│      ┌──────┐                                                               │
│      │  1234│                                                               │
│      └──┬┬┬─┘                                                               │
│         │││                                                                 │
│     VCC─┘││                    Pin 1 = VCC  (5V)                           │
│      DATA─┼┘                   Pin 2 = DATA (Pin 2 Arduino)                │
│       GND─┘                    Pin 3 = No conectar                         │
│                                Pin 4 = GND                                  │
│                                                                             │
│      Resistencia pull-up 10kΩ entre DATA y VCC                             │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│  2. SENSOR DE HUMEDAD DEL SUELO (Capacitivo)                               │
│                                                                             │
│      ┌──────────────┐                                                       │
│      │   ▓▓▓▓▓▓▓▓  │  ← Inserta en la tierra                              │
│      │   ▓▓▓▓▓▓▓▓  │                                                       │
│      │   ▓▓▓▓▓▓▓▓  │                                                       │
│      └──────┬───────┘                                                       │
│             │                                                               │
│      VCC GND AOUT                                                           │
│       │   │   │                                                             │
│       │   │   └────────────► A0 (Arduino)                                  │
│       │   └────────────────► GND (Arduino)                                 │
│       └────────────────────► 5V (Arduino)                                  │
│                                                                             │
│      Salida: 0-1023 (0 = muy húmedo, 1023 = muy seco)                      │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│  3. SENSOR DE LUZ LDR (Fotoresistor)                                       │
│                                                                             │
│      Circuito divisor de voltaje:                                          │
│                                                                             │
│      5V ───┬───[LDR]───┬──── A1 (Arduino)                                  │
│            │           │                                                    │
│          [10kΩ]     [10kΩ]                                                  │
│            │           │                                                    │
│           GND         GND                                                   │
│                                                                             │
│      Salida: 0-1023 (0 = oscuro, 1023 = muy iluminado)                     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                         ESQUEMA COMPLETO DEL SISTEMA
═══════════════════════════════════════════════════════════════════════════════

                         INTERNET / RED LOCAL
                                  │
                                  │ WiFi
                                  ▼
                      ┌──────────────────────┐
                      │   ROUTER WiFi        │
                      │   192.168.1.1        │
                      └──────────┬───────────┘
                                 │
                 ┌───────────────┴───────────────┐
                 │                               │
          ┌──────▼─────┐                  ┌──────▼─────┐
          │  Backend   │                  │  Arduino   │
          │  Node.js   │                  │  R4 WiFi   │
          │  :4000     │                  │  (Sensor)  │
          └──────┬─────┘                  └──────┬─────┘
                 │                               │
                 │                               │
          ┌──────▼─────┐                  ┌──────▼─────┐
          │ PostgreSQL │                  │   Sensores │
          │  Database  │                  │   + Relé   │
          └────────────┘                  └────────────┘
                                                 │
                                          ┌──────▼─────┐
                                          │  Bomba de  │
                                          │    Agua    │
                                          └────────────┘

Flujo de Datos:
1. Arduino lee sensores (HC-SR04, DHT22, etc.)
2. Arduino envía datos por WiFi al Backend (HTTP POST)
3. Backend valida y guarda datos en PostgreSQL
4. Backend puede enviar comandos al Arduino
5. Frontend muestra datos en tiempo real


═══════════════════════════════════════════════════════════════════════════════
                      LISTA DE MATERIALES (BOM)
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│ Cantidad │ Componente                    │ Especificaciones                │
├──────────┼───────────────────────────────┼─────────────────────────────────┤
│    1     │ Arduino Uno R4 WiFi           │ Con WiFi integrado              │
│    1     │ Sensor Ultrasónico HC-SR04    │ Rango 2-400cm                   │
│    1     │ Módulo Relé 1 Canal           │ 5V, 10A                         │
│    1     │ Bomba de agua 12V DC          │ Para riego                      │
│    1     │ Fuente de alimentación 12V    │ 1-2A mínimo                     │
│    1     │ Diodo 1N4007                  │ Protección de relé              │
│    1     │ Cable USB para Arduino        │ Tipo B                          │
│   10     │ Cables Dupont macho-macho     │ 20cm                            │
│   10     │ Cables Dupont macho-hembra    │ 20cm                            │
│    1     │ Protoboard (opcional)         │ 830 puntos                      │
│    1     │ Sensor DHT22 (opcional)       │ Temp. y humedad                 │
│    1     │ Sensor Humedad Suelo (opc.)   │ Capacitivo                      │
│    1     │ Fotoresistor LDR (opcional)   │ 5-10kΩ                          │
│    2     │ Resistencias 10kΩ (opcional)  │ 1/4W                            │
└──────────┴───────────────────────────────┴─────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                          NOTAS DE SEGURIDAD
═══════════════════════════════════════════════════════════════════════════════

⚠️  IMPORTANTE:

1. ALIMENTACIÓN:
   - NO conectar bomba 12V directamente al Arduino
   - Usar relé con fuente de alimentación externa
   - Verificar polaridad antes de conectar

2. PROTECCIÓN:
   - Instalar diodo volante (1N4007) en paralelo con la bomba
   - Evitar cortocircuitos
   - No exceder corriente máxima del relé (10A)

3. AGUA Y ELECTRICIDAD:
   - Mantener Arduino y conexiones LEJOS del agua
   - Usar caja impermeable para exteriores
   - Verificar aislamiento de cables

4. SENSORES:
   - No sumergir completamente el HC-SR04
   - Sensor de humedad: solo las puntas en tierra
   - Limpiar sensores regularmente

5. SOFTWARE:
   - Implementar timeouts en WiFi
   - Validar lecturas de sensores (rango válido)
   - Reintentos en caso de fallo de conexión


═══════════════════════════════════════════════════════════════════════════════

Desarrollado por: Javier Prado
Proyecto: Sistema de Riego Inteligente AgroIrrigate
Seminario de Tecnologías de Información - Décimo Semestre
Fecha: Octubre 2025

═══════════════════════════════════════════════════════════════════════════════

